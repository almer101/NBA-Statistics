---
title: "NBADescriptive"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Opis podataka


```{r Data input }

seasons.stats = read.csv(file = "../data/Seasons_Stats.csv", header = TRUE)
head(seasons.stats)
```

``` {r Average 3PA/2PA }
library(tidyverse) # sluzi za grupiranja, joinove, filtriranja

# plotting average points per year through all seasons
seasons.stats %>% group_by(Year) %>% summarize(avg.PTS = mean(PTS)) -> average.points
average.points
plot(average.points, xlab = "Year", ylab = "Average points")

# plotting average three and two point attempts per year
season.stats.points = seasons.stats[c('Year', 'X3PA', 'X2PA', 'G')]

season.stats.points$X3PAPerGame = season.stats.points$X3PA / season.stats.points$G
season.stats.points$X2PAPerGame = season.stats.points$X2PA / season.stats.points$G
head(season.stats.points)
season.stats.points.complete = season.stats.points[complete.cases(season.stats.points),]
head(season.stats.points.complete)

#x3paByYear %>% group_by(Year) %>% summarize(ThreePointAttempts = mean(X3PA)) -> threePointAttempts
season.stats.points.complete %>% group_by(Year) %>% summarize(ThreePointAttempts = mean(X3PAPerGame)) -> three.point.attempts
season.stats.points.complete %>% group_by(Year) %>% summarize(TwoPointAttempts = mean(X2PAPerGame)) -> two.point.attempts

three.point.attempts
two.point.attempts

# plotting three and two point attempts through the years
plot(
  three.point.attempts$Year, 
  three.point.attempts$ThreePointAttempts, 
  xlim = c(min(three.point.attempts$Year), max(three.point.attempts$Year)),
  ylim = c(min(three.point.attempts$ThreePointAttempts), max(three.point.attempts$ThreePointAttempts)),
  xlab = "Year",
  ylab = "3PA per game",
  col = 'blue'
)
plot(three.point.attempts$Year, two.point.attempts$TwoPointAttempts, col='red')

```
# 

Filozofija igre je 60-ih i 70-ih godina bila takva da je tempo igre je bio puno brzi, odnosno bilo je ukupno vise posjeda lopte.


```{r Fouls and Free throw attempts per year }


seasons.stats %>% group_by(Year) %>% summarize(PFAvg = mean(PF)) -> average.fouls
average.fouls
plot(average.fouls)

seasons.stats %>% group_by(Year) %>% summarize(FTAAvg = mean(FTA)) -> average.free.throw.attempts
average.free.throw.attempts
plot(average.free.throw.attempts)


```

NBA je entertainment industrija i gledanost im je jako bitan aspekt s obzirom da gledanost nosi profit. Foulovi usporavaju igru, i u korist tome govori i novo uvedeno pravilo, da se foulovi u kontri kaznjavaju nesportskim greskama (2 bacanja i posjed lopte), sto obeshrabruje obrambene igrace da rade foulove u kontri. Namjera tog pravila je da se kontre maksimalno dopustaju s obzirom da najcesce rezultiraju atraktivnom zavrsnicom sto pogoduje gledanosti.


```{r}

plot(seasons.stats$PF, seasons.stats$PTS)
plot(seasons.stats$MP, seasons.stats$PF)

```

Vidi se lagani porast zbog korelacije izmedu 

```{r}

head(seasons.stats)
player.data = read.csv("../data/player_data.csv")
players = read.csv('../data/Players.csv')

head(seasons.stats)
head(player.data)
head(players)

seasons.stats %>% group_by(Player) %>% summarize(PlayerPTSAvg = mean(PTS)) -> playerPTSAverage
playerPTSAverage

player.season.data = merge(x = playerPTSAverage, y = players, by = "Player", all.y = TRUE)

head(player.season.data)

plot(player.season.data$height, player.season.data$PlayerPTSAvg)
hist(player.season.data$height)
hist(player.season.data$weight)

player.heights.complete = player.season.data$height[complete.cases(player.season.data$height)]

mean(player.heights.complete)
median(player.heights.complete)
sd(player.heights.complete)

boxplot(player.heights.complete, main='Players height boxplot', ylab='Players height [cm]')

min(player.heights.complete)
max(player.heights.complete)

```

```{r}

# grupiranje po pozicijama
head(player.data)

players.joined = inner_join(player.data, players, by=c("name" = "Player"))

players.joined %>% group_by(position) %>% summarize(averageHeight = mean(height.y)) -> averageHeightForPlayersByPosition
averageHeightForPlayersByPosition

plot(averageHeightForPlayersByPosition$position, averageHeightForPlayersByPosition$averageHeight)

```

Dobiveni su podaci kao i ocekivani, pozicije G (Guards) ne zahtijevaju da su igraci visoki, dok za pozicije F (Forward) i C (Center) se zahtijeva visina zbog uloge koje imaju u igri.

Braniče (Guards - G) tradicionalno čine razigravač (poznatiji pod imenom playmaker) i bek šuter. Neke od njihovih osobina su brzina, odlična kontrola lopte, spretnost i mehanička potkovanost koja najčešće jako korelira s dobrim šuterskim sposobnostima. S obzirom na spomenute osobine braniči su najčešće ispodprosječne visine.

Krila (Forwards - F) tradicionalno čine nisko i visoko krilo. Od niskog krila se očekuje svestranost i u napadu i u obrani, što podrazumijeva relativno nadprosječnu visinu s obzirom da su im obrambene zadaće izrazito šarolike (očekuje se switchableness kroz većinu pozicija u obrani od blokova), a napadački moraju moći završiti ulaze pored takozvanih rim protectora (braniča obruča). Visoka krila uz centre najčešće sačinjavaju "tornjeve u reketu" koji odrađuju funkcije visokih igrača (postavljanje blokova, blokiranje ulaza i sl.), no u modernijoj košarci se od njih podrazumijeva da mogu širiti teren, odnosno očekuje se nadprosječan postotak ubačaja za tri poena. Često se i koriste kao "small-ball petice" kako bi se ubrzala igra i maksimizirala obrambena fleksibilnost dok se pritom relativno zadržala visina spomenute pozicije.

Centri (Centers - C) su zaduženi za "prljavi posao" u reketu (obrambeni i napadački skok, rim protection, postavljanje blokova i sl.) u čemu im visina maksimalno pogoduje, no povlači i tromost koja nije toliki problem s obzirom da su većinom usidreni u reketu, no to ih čini dosta ranjivima prilikom preuzimanja u obrani.

Valja napomenuti kako se u zadnje vrijeme sve više gubi tradicionalna podjela po pet pozicija, a sve se više gura tzv. "positionless basketball" gdje svaki trener kroji petorke na način koji mu odgovara protiv određenog protivnika te za željeni stil igre. Jedan od prijedloga modernih pozicija čine "ball-handleri" (koji najviše odgovaraju braničima), krila (koji najviše odgovaraju niskim krilima) i visoki (koji najviše odgovaraju visokim krilima i centrima).

```{r Duke University vs Other in terms of True Shooting Percentage }

library(tidyverse)

seasons.stats$TS.

season.player.nice.data = inner_join(seasons.stats, player.data, by=c("Player" = "name"))

season.player.nice.data %>% filter(college=="Duke University") -> duke.players
duke.players

summary(duke.players$TS.)
hist(duke.players$TS.)

season.player.nice.data %>% filter(college!="Duke University") -> not.duke.players
summary(not.duke.players$TS.)
hist(not.duke.players$TS.)

plot(hist(duke.players$TS.), col='red')
plot(hist(not.duke.players$TS.), col='blue', add=T)

dg = 0
gg = 1.2

set.seed(42)
hist(duke.players$TS., xlim=c(dg,gg), prob=TRUE, col='blue', border=F)
hist(not.duke.players$TS., add=T, xlim=c(dg,gg), prob=TRUE, col=scales::alpha('red',.5), border=F)

length(duke.players$TS.)
length(not.duke.players$TS.)
boxplot(duke.players$TS., not.duke.players$TS.)

h0.mean = mean(not.duke.players$TS.)

t.test(duke.players$TS., not.duke.players$TS., alternative="greater", var.equal = TRUE)
t.test(duke.players$TS., not.duke.players$TS., alternative="greater", var.equal = FALSE)

```
```{r Top 10 Universities True Shooting Percentage }

top.10.colleges = factor(c(
  'Duke University', 
  'University of North Carolina',
  'University of Kentucky',
  'Kansas State University',
  'Michigan State University',
  'Villanova University',
  'Indiana University',
  'University of Michigan',
  'University of Louisville',
  'Syracuse University'
))

season.player.nice.data
season.player.nice.data %>% filter(Year > 1990 & college %in% top.10.colleges) -> seasons.stats.after.1990
seasons.stats.after.1990 = seasons.stats.after.1990[c("TS.", "college")]
seasons.stats.after.1990
seasons.stats.after.1990 = seasons.stats.after.1990[complete.cases(seasons.stats.after.1990),]
seasons.stats.after.1990

seasons.stats.after.1990 %>% group_by(college) %>% summarize(ts.college.average = mean(TS.)) -> avg.ts.top.10.colleges
avg.ts.top.10.colleges

avg.ts.top.10.colleges <- avg.ts.top.10.colleges[order(-avg.ts.top.10.colleges$ts.college.average),]
avg.ts.top.10.colleges

barplot(
  avg.ts.top.10.colleges$ts.college.average,
  ylim = c(0, 0.6),
  main = "Average TS value for top 10 universities in USA",
  ylab = "Average TS [%]",
  xlab = "College in USA",
  names.arg = avg.ts.top.10.colleges$college,
  col = "steelblue",
  las = 2,
  cex.names = 0.75
)

```


```{r Dependance of 3PA on Offensive Rebounds }

head(seasons.stats)

help.table = seasons.stats[c("Year", "X3PA", "ORB", "ORB.")]
head(help.table)
help.table = help.table[complete.cases(help.table),]
help.table

help.table %>% group_by(Year) %>% summarize(three.point.attempts = mean(X3PA)) -> average.three.point.attempts.by.year
help.table %>% group_by(Year) %>% summarize(offensive.rebounds = mean(ORB)) -> average.orb.by.year
help.table %>% group_by(Year) %>% summarize(offensive.rebounds.percentage = mean(ORB)) -> average.orb.percentage.by.year

average.three.point.attempts.by.year
average.orb.by.year

plot(average.three.point.attempts.by.year)
plot(average.orb.by.year)

plot(average.three.point.attempts.by.year$three.point.attempts, average.orb.by.year$offensive.rebounds)
plot(average.three.point.attempts.by.year$three.point.attempts, average.orb.percentage.by.year$offensive.rebounds.percentage)
average.three.point.attempts.by.year$three.point.attempts
average.orb.by.year$offensive.rebounds

```
```{r Kardashian Curse}
khloe.kardashian.boyfriends = factor(c(
  "Rashad McCants",
  "Lamar Odom",
  "James Harden",
  "Tristan Thompson"
))
kim.kardashian.boyfriends = c(
  "Kris Humphries"
)

#seasons.stats

#seasons.stats %>% filter(Player == "Lamar Odom") -> boyfriends
#boyfriends

bar_plot_boyfriends <- function(boyfriends) {
  for (boyfriend in boyfriends) {
    seasons.stats %>% filter(Player == boyfriend) %>% group_by(Year) %>% summarize(mp.sum = sum(MP)) -> boyfriend.data
    barplot(
      boyfriend.data$mp.sum,
      main = boyfriend,
      names.arg = boyfriend.data$Year,
      ylab = "Minutes played [s]",
      xlab = "Year",
      col = "steelblue",
      space = 0.3
    )
  }
}

bar_plot_boyfriends(khloe.kardashian.boyfriends)
bar_plot_boyfriends(kim.kardashian.boyfriends)

```

``` {r Ratio of countries in NBA League}
usa.states = factor(c(
  "Alabama", 
  "Alaska", 
  "Arizona", 
  "Arkansas", 
  "California", 
  "Colorado", 
  "Connecticut", 
  "Delaware", 
  "Florida", 
  "Georgia", 
  "Hawaii", 
  "Idaho", 
  "Illinois",
  "Indiana", 
  "Iowa", 
  "Kansas", 
  "Kentucky", 
  "Louisiana", 
  "Maine", 
  "Maryland", 
  "Massachusetts", 
  "Michigan", 
  "Minnesota", 
  "Mississippi", 
  "Missouri", 
  "Montana",
  "Nebraska", 
  "Nevada",
  "New Hampshire",
  "New Jersey",
  "New Mexico",
  "New York",
  "North Carolina",
  "North Dakota",
  "Ohio", 
  "Oklahoma",
  "Oregon",
  "Pennsylvania",
  "Rhode Island",
  "South Carolina",
  "South Dakota",
  "Tennessee",
  "Texas",
  "Utah",
  "Vermont",
  "Virginia",
  "Washington",
  "West Virginia",
  "Wisconsin",
  "Wyoming",
  "District of Columbia"
))

players
players %>% group_by(birth_state) %>% summarize(count = length(Player)) -> countries.count
countries.count %>% filter(birth_state %in% usa.states) %>% summarize(usa.sum = sum(count)) -> usa.players.count
countries.count %>% filter(!(birth_state %in% usa.states)) -> countries.players
countries.count
usa.players.count

new.row = data.frame(factor("USA"), usa.players.count)
new.row

countries.players = countries.players[-c(1),]

names(new.row) = names(countries.players)
countries.players = rbind(countries.players, new.row)
countries.players

countries.players <- countries.players[order(-countries.players$count),]
countries.players

countries.players %>% filter(count < 3000) %>% summarize(others.sum = sum(count)) -> others.count
others.count
countries.players %>% filter(count >= 3000) -> countries.players
countries.players

new.row = data.frame(factor("Others"), others.count)
names(new.row) = names(countries.players)
countries.players = rbind(countries.players, new.row)
countries.players

pie(countries.players$count, labels = countries.players$birth_state, main = "Ratio of countries in NBA")

test = countries.players$count > 1000
test

countries.players[test,]

```
```{r}

years = seq(1950, 2019, by=10)
years

"
seasons.stats
players
test = seasons.stats$Year > 1960 & seasons.stats$Year < 1970
test
test = test[complete.cases(test)]
combined = seasons.stats[test,]
combined$Player <- as.factor(combined$Player)
combined

combined1 = inner_join(combined, players, by = c(Player = Player))
combined1
combined2 = combined1 %>% distinct(combined1$Player, combined1$birth_state)
combined2"

#distinct(seasons.stats$Player)

decades = c()
usa.counts = c()
others.counts = c()

for (year in years) {
  test = seasons.stats$Year > year & seasons.stats$Year < (year + 10)
  combined = seasons.stats[test,]
  combined$Player = as.factor(combined$Player)
  
  combined.1 = inner_join(combined, players, by=c("Player" = "Player"))
  combined.1$Player = as.character(combined.1$Player)
  combined.1$birth_state = as.character(combined.1$birth_state)
  combined.2 = combined.1 %>% distinct(combined.1$Player, combined.1$birth_state)
  
  decades <- c(decades, year)
  
  combined.2 %>% group_by(birth_state) %>% summarize(count = length(Player)) -> countries.count
  countries.count %>% filter(birth_state %in% usa.states) %>% summarize(usa.sum = sum(count)) -> usa.players.count
  usa.counts <- c(usa.counts, usa.players.count)

  countries.count %>% filter(!(birth_state %in% usa.states)) %>% summarize(others.sum = sum(count)) -> other.players.count
  others.count <- c(others.count, other.players.count)
}

usa.counts
other.counts
df

?barplot
table <- table(usa.counts, others.counts)

```

